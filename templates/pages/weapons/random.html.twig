{% extends 'base.html.twig' %}

{% block title %}
    <title>{{ 'Losowanie broni do trybu' }}</title>
{% endblock %}

{% block content %}


    <div class="card row col-lg-4 offset-lg-4">
        <div class="card-header text-center">
            <h3>{{ 'Losowa broń' }}</h3>
        </div>
        <div class="card-body row">
            <div>
                <div class="row text-center">
                    <div class="col-lg-6">
                        <div class="range">
                            <span>{{ 'min = 1 / max = 10' }}</span>
                            <label class="form-label">Current: <span id="normalWeaponsCountCurrent">1</span></label>
                            <input type="range" id="normalWeaponsCount" class="form-range" min="1" max="10"
                                   value="1">
                        </div>
                        <label for="normalWeaponsCount">{{ "Liczba normalnych broni / narzędzi" }}</label>
                    </div>

                    <div class="col-lg-6">
                        <div class="range">
                            <span>{{ 'min = 1 / max = 10' }}</span>
                            <label class="form-label">Current: <span id="craftedWeaponsCountCurrent">1</span></label>
                            <input type="range" id="craftedWeaponsCount" class="form-range" min="1" max="10"
                                   value="1">
                        </div>
                        <label for="craftedWeaponsCount">{{ "Liczba wytworzonych broni / narzędzi" }}</label>
                    </div>
                </div>

                <div class="row mt-4 text-center">
                    <p>{{ 'Dodatkowe opcje' }}</p>
                    <div class="col-lg-6">
                        <p>
                            <input type="checkbox" id="includeTools">
                            <label for="includeTools">{{ "Uwzględnij narzędzia w losowaniu" }}</label>
                        </p>
                    </div>
                    <div class="col-lg-6">
                        <p>
                            <input type="checkbox" id="includeOpenMapWeapons">
                            <label for="includeOpenMapWeapons">{{ "Uwzględnij bronie na otwarte mapy" }}</label>
                        </p>
                    </div>
                </div>
                <div class="mt-2 text-center">
                    <button type="button" id="rollButton" class="btn btn-success">{{ 'Losuj' }}</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row text-center">
        <div class="card col-lg-5">
            <div class="card-header">
                <h2 style="font-weight: 600">{{ 'Normalne bronie / narzędzia' }}</h2>
            </div>
            <div class="card-body row">
                <div class="col-lg-12">
                    <p id="normalWeapons" style="color: brown">
                    </p>
                </div>
            </div>
        </div>
        <div class="card col-lg-5 offset-lg-2">
            <div class="card-header">
                <h2 style="font-weight: 600">{{ 'Wytworzone bronie / narzędzia' }}</h2>
            </div>
            <div class="card-body row">
                <p id="craftedWeapons" style="color: lightsalmon">
                </p>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts_bottom %}
    {{ parent() }}
    <script>

        const events = ['change']

        $.each(events, function(k,v) {
            $('#craftedWeaponsCount').on(v, function() {
                $('#craftedWeaponsCountCurrent').text($('#craftedWeaponsCount').val());
            });
        })

        $.each(events, function(k,v) {
            $('#normalWeaponsCount').on(v, function() {
                $('#normalWeaponsCountCurrent').text($('#normalWeaponsCount').val());
            });
        })

        $('body').on('click', '#rollButton', function () {
            let countNormal = $('#normalWeaponsCount').val();
            let countCrafted = $('#craftedWeaponsCount').val();
            let includeTools = $('#includeTools').is(":checked");
            let includeOpenMapWeapons = $('#includeOpenMapWeapons').is(":checked");

            let settings = {
                'url': "{{ path('weapons_random_get') }}",
                'type': "POST",
                'data': {
                    'countNormal': countNormal,
                    'countCrafted': countCrafted,
                    'includeTools': includeTools,
                    'includeOpenMapWeapons': includeOpenMapWeapons
                }
            }
            $.ajax(settings)
                .done(function (response) {
                    let normalWeaponsEl = $('#normalWeapons');
                    let craftedWeaponsEl = $('#craftedWeapons');

                    craftedWeaponsEl.empty();
                    normalWeaponsEl.empty();

                    let craftedWeapons = response.craftedWeapons;
                    let normalWeapons = response.normalWeapons;

                    $.each(craftedWeapons, function (i, l) {
                        craftedWeaponsEl.append("<p>" + l + "<p>");
                    });

                    $.each(normalWeapons, function (i, l) {
                        normalWeaponsEl.append("<p>" + l + "<p>");
                    });
                });
        });
    </script>
{% endblock %}